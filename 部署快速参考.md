# ğŸš€ LingSu Health éƒ¨ç½²å¿«é€Ÿå‚è€ƒ

## ğŸ“ æ ¸å¿ƒæ¦‚å¿µ

### å‰åç«¯åˆ†ç¦»æ¶æ„
```
ç”¨æˆ·æµè§ˆå™¨
    â†“ (è®¿é—®ç½‘é¡µ)
Nginx (80/443ç«¯å£)
    â”œâ”€â†’ å‰ç«¯é™æ€æ–‡ä»¶ (/var/www/lingsu-health)
    â””â”€â†’ API åå‘ä»£ç† (/api â†’ localhost:8080)
            â†“
    Spring Boot åç«¯ (8080ç«¯å£)
            â†“
    MySQL æ•°æ®åº“ (3306ç«¯å£)
```

---

## âš¡ ä¸‰ç§éƒ¨ç½²æ–¹å¼

### æ–¹å¼ä¸€ï¼šä¸€é”®åˆå§‹åŒ–ï¼ˆæ¨èé¦–æ¬¡éƒ¨ç½²ï¼‰
```bash
# åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œ
curl -sSL https://raw.githubusercontent.com/your-username/LingSuHealth/main/deploy/setup-server.sh | bash
# æˆ–è€…
wget -O - https://raw.githubusercontent.com/your-username/LingSuHealth/main/deploy/setup-server.sh | bash
```

### æ–¹å¼äºŒï¼šæ‰‹åŠ¨éƒ¨ç½²ï¼ˆå®Œå…¨æ§åˆ¶ï¼‰
å‚è€ƒ `éƒ¨ç½²æŒ‡å—.md` çš„è¯¦ç»†æ­¥éª¤

### æ–¹å¼ä¸‰ï¼šè‡ªåŠ¨åŒ– CI/CDï¼ˆæ¨èæŒç»­éƒ¨ç½²ï¼‰
1. é…ç½® GitHub Actionsï¼ˆè§ `.github/workflows/deploy.yml`ï¼‰
2. æ¯æ¬¡ push åˆ° main åˆ†æ”¯è‡ªåŠ¨éƒ¨ç½²

---

## ğŸ“¦ æ–‡ä»¶è¯´æ˜

| æ–‡ä»¶ | ç”¨é€” |
|------|------|
| `éƒ¨ç½²æŒ‡å—.md` | è¯¦ç»†çš„éƒ¨ç½²æ­¥éª¤å’Œè¯´æ˜æ–‡æ¡£ |
| `README.md` | é¡¹ç›®ä»‹ç»å’Œä½¿ç”¨è¯´æ˜ |
| `deploy/nginx.conf` | Nginx é…ç½®æ¨¡æ¿ |
| `deploy/lingsu-health.service` | Systemd æœåŠ¡é…ç½® |
| `deploy/deploy.sh` | å¿«é€Ÿéƒ¨ç½²è„šæœ¬ï¼ˆç”¨äºæ›´æ–°ï¼‰ |
| `deploy/backup.sh` | æ•°æ®åº“å¤‡ä»½è„šæœ¬ |
| `deploy/setup-server.sh` | æœåŠ¡å™¨ä¸€é”®åˆå§‹åŒ–è„šæœ¬ |
| `.github/workflows/deploy.yml` | GitHub Actions è‡ªåŠ¨éƒ¨ç½² |
| `application.yml.template` | é…ç½®æ–‡ä»¶æ¨¡æ¿ï¼ˆä¿æŠ¤æ•æ„Ÿä¿¡æ¯ï¼‰ |

---

## ğŸ”‘ å…³é”®è·¯å¾„

### æœåŠ¡å™¨ä¸Šçš„ç›®å½•
- **åç«¯ä»£ç **ï¼š`/opt/lingsu-health/`
- **å‰ç«¯æ–‡ä»¶**ï¼š`/var/www/lingsu-health/`
- **Nginx é…ç½®**ï¼š`/etc/nginx/sites-available/lingsu-health`
- **ç³»ç»ŸæœåŠ¡**ï¼š`/etc/systemd/system/lingsu-health.service`
- **æ•°æ®åº“å¤‡ä»½**ï¼š`/backup/lingsu-health/`

### é…ç½®æ–‡ä»¶
- **åç«¯é…ç½®**ï¼š`src/main/resources/application.yml`
- **å‰ç«¯ API**ï¼š`ui/src/services/api.ts`

---

## ğŸ¯ é¦–æ¬¡éƒ¨ç½²å®Œæ•´æµç¨‹

### 1ï¸âƒ£ æœ¬åœ°å‡†å¤‡
```bash
# åˆ›å»º .gitignoreï¼ˆå·²æä¾›ï¼‰
# åˆ›å»º application.yml.templateï¼ˆå·²æä¾›ï¼‰
# åˆå§‹åŒ– Git
git init
git add .
git commit -m "Initial commit"

# æ¨é€åˆ° GitHub
git remote add origin https://github.com/your-username/LingSuHealth.git
git push -u origin main
```

### 2ï¸âƒ£ æœåŠ¡å™¨åˆå§‹åŒ–
```bash
# SSH è¿æ¥æœåŠ¡å™¨
ssh root@æœåŠ¡å™¨IP

# è¿è¡Œä¸€é”®åˆå§‹åŒ–è„šæœ¬
curl -sSL https://raw.githubusercontent.com/your-username/LingSuHealth/main/deploy/setup-server.sh | bash

# æˆ–è€…æ‰‹åŠ¨éƒ¨ç½²ï¼ˆå‚è€ƒéƒ¨ç½²æŒ‡å—.mdï¼‰
```

### 3ï¸âƒ£ é…ç½®æ•æ„Ÿä¿¡æ¯
```bash
# ç¼–è¾‘é…ç½®æ–‡ä»¶
vim /opt/lingsu-health/src/main/resources/application.yml

# ä¿®æ”¹ä»¥ä¸‹å†…å®¹ï¼š
# - MySQL å¯†ç 
# - DeepSeek API Key
```

### 4ï¸âƒ£ é¦–æ¬¡æ„å»ºå’Œéƒ¨ç½²
```bash
cd /opt/lingsu-health
chmod +x deploy/deploy.sh
bash deploy/deploy.sh
```

### 5ï¸âƒ£ éªŒè¯éƒ¨ç½²
```bash
# æ£€æŸ¥åç«¯æœåŠ¡
systemctl status lingsu-health

# æ£€æŸ¥ Nginx
systemctl status nginx

# æµ‹è¯•è®¿é—®
curl http://localhost:8080/api/health
curl http://æœåŠ¡å™¨IP
```

---

## ğŸ”„ æ—¥å¸¸æ›´æ–°æµç¨‹

### æœ¬åœ°å¼€å‘ â†’ æ¨é€ GitHub â†’ æœåŠ¡å™¨æ›´æ–°

```bash
# ===== åœ¨æœ¬åœ° =====
# 1. ä¿®æ”¹ä»£ç 
vim src/main/java/...

# 2. æµ‹è¯•
mvn spring-boot:run

# 3. æäº¤åˆ° GitHub
git add .
git commit -m "ä¿®å¤äº†æŸä¸ª bug"
git push origin main

# ===== åœ¨æœåŠ¡å™¨ =====
# 4. å¿«é€Ÿéƒ¨ç½²ï¼ˆè‡ªåŠ¨æ‹‰å–ã€æ„å»ºã€é‡å¯ï¼‰
ssh root@æœåŠ¡å™¨IP
cd /opt/lingsu-health
bash deploy/deploy.sh
```

### æˆ–è€…ä½¿ç”¨ GitHub Actions è‡ªåŠ¨éƒ¨ç½²
é…ç½®åï¼Œæ¯æ¬¡ push åˆ° main åˆ†æ”¯è‡ªåŠ¨è§¦å‘éƒ¨ç½²ï¼

---

## ğŸ› ï¸ å¸¸ç”¨å‘½ä»¤é€ŸæŸ¥

### åç«¯ç®¡ç†
```bash
# å¯åŠ¨
systemctl start lingsu-health

# åœæ­¢
systemctl stop lingsu-health

# é‡å¯
systemctl restart lingsu-health

# æŸ¥çœ‹çŠ¶æ€
systemctl status lingsu-health

# æŸ¥çœ‹æ—¥å¿—
journalctl -u lingsu-health -f

# æ‰‹åŠ¨è¿è¡Œï¼ˆè°ƒè¯•ç”¨ï¼‰
java -jar target/LingSuHealth-0.0.1-SNAPSHOT.jar
```

### å‰ç«¯ç®¡ç†
```bash
# é‡æ–°æ„å»ºå’Œéƒ¨ç½²
cd /opt/lingsu-health/ui
npm run build
cp -r dist/* /var/www/lingsu-health/

# æˆ–ä½¿ç”¨å¿«é€Ÿéƒ¨ç½²è„šæœ¬
bash /opt/lingsu-health/deploy/deploy.sh
```

### Nginx ç®¡ç†
```bash
# æµ‹è¯•é…ç½®
nginx -t

# é‡å¯
systemctl restart nginx

# æŸ¥çœ‹æ—¥å¿—
tail -f /var/log/nginx/error.log
tail -f /var/log/nginx/access.log
```

### æ•°æ®åº“ç®¡ç†
```bash
# å¤‡ä»½
bash /opt/lingsu-health/deploy/backup.sh

# æ‰‹åŠ¨å¤‡ä»½
mysqldump -u lingshu_user -p lingsu_health > backup.sql

# æ¢å¤
mysql -u lingshu_user -p lingsu_health < backup.sql

# ç™»å½•æ•°æ®åº“
mysql -u lingshu_user -p
```

### Git ç®¡ç†
```bash
# æ‹‰å–æœ€æ–°ä»£ç 
git pull origin main

# æŸ¥çœ‹çŠ¶æ€
git status

# æŸ¥çœ‹æ—¥å¿—
git log --oneline

# å›é€€ç‰ˆæœ¬
git reset --hard commit_id
```

---

## ğŸ” æ•…éšœæ’æŸ¥

### åç«¯æ— æ³•å¯åŠ¨
```bash
# 1. æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
journalctl -u lingsu-health -n 100

# 2. æ£€æŸ¥ç«¯å£å ç”¨
lsof -i :8080

# 3. æ£€æŸ¥é…ç½®æ–‡ä»¶
cat src/main/resources/application.yml

# 4. æµ‹è¯•æ•°æ®åº“è¿æ¥
mysql -u lingshu_user -p lingsu_health
```

### å‰ç«¯æ— æ³•è®¿é—®
```bash
# 1. æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨
ls -la /var/www/lingsu-health/

# 2. æ£€æŸ¥ Nginx é…ç½®
nginx -t

# 3. æ£€æŸ¥ Nginx æ—¥å¿—
tail -f /var/log/nginx/error.log

# 4. æ£€æŸ¥é˜²ç«å¢™
ufw status
```

### API è¯·æ±‚ 404
```bash
# 1. ç¡®è®¤åç«¯æ­£å¸¸è¿è¡Œ
curl http://localhost:8080/api/health

# 2. æ£€æŸ¥ Nginx åå‘ä»£ç†é…ç½®
cat /etc/nginx/sites-available/lingsu-health

# 3. æ£€æŸ¥å‰ç«¯ API é…ç½®
cat /opt/lingsu-health/ui/src/services/api.ts
```

---

## ğŸ”’ å®‰å…¨æ£€æŸ¥æ¸…å•

- [ ] ä¿®æ”¹äº† MySQL root å¯†ç ï¼ˆå¼ºå¯†ç ï¼‰
- [ ] åˆ›å»ºäº†å•ç‹¬çš„ MySQL åº”ç”¨ç”¨æˆ·
- [ ] application.yml æ²¡æœ‰æäº¤åˆ° GitHub
- [ ] DeepSeek API Key å¦¥å–„ä¿ç®¡
- [ ] é…ç½®äº†é˜²ç«å¢™ï¼ˆä»…å¼€æ”¾ 22, 80, 443ï¼‰
- [ ] é…ç½®äº† HTTPS è¯ä¹¦
- [ ] è®¾ç½®äº†æ•°æ®åº“è‡ªåŠ¨å¤‡ä»½
- [ ] ç¦ç”¨äº† MySQL è¿œç¨‹è®¿é—®ï¼ˆæˆ–é™åˆ¶ IPï¼‰

---

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–å»ºè®®

### åç«¯
```yaml
# application.yml
spring:
  datasource:
    hikari:
      maximum-pool-size: 10
      minimum-idle: 5
      connection-timeout: 30000
```

### å‰ç«¯
- å¯ç”¨ Nginx Gzip å‹ç¼© âœ…ï¼ˆå·²é…ç½®ï¼‰
- é…ç½®é™æ€èµ„æºç¼“å­˜ âœ…ï¼ˆå·²é…ç½®ï¼‰
- ä½¿ç”¨ CDN åŠ é€Ÿï¼ˆå¯é€‰ï¼‰

### æ•°æ®åº“
```sql
-- æ·»åŠ ç´¢å¼•
CREATE INDEX idx_user_date ON health_checkins(user_id, checkin_date);
CREATE INDEX idx_user_created ON assessment_records(user_id, created_at);
```

---

## ğŸ“ è·å–å¸®åŠ©

### æ—¥å¿—ä½ç½®
- **åç«¯æ—¥å¿—**ï¼š`journalctl -u lingsu-health -f`
- **Nginx é”™è¯¯æ—¥å¿—**ï¼š`/var/log/nginx/error.log`
- **Nginx è®¿é—®æ—¥å¿—**ï¼š`/var/log/nginx/access.log`
- **MySQL æ—¥å¿—**ï¼š`/var/log/mysql/error.log`

### å¸¸è§é—®é¢˜
1. **"ç«¯å£ 8080 è¢«å ç”¨"** â†’ `lsof -i :8080` æŸ¥çœ‹å ç”¨è¿›ç¨‹
2. **"æ•°æ®åº“è¿æ¥å¤±è´¥"** â†’ æ£€æŸ¥ application.yml ä¸­çš„å¯†ç 
3. **"å‰ç«¯ç™½å±"** â†’ æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°å’Œ Network æ ‡ç­¾
4. **"502 Bad Gateway"** â†’ åç«¯æœåŠ¡æœªå¯åŠ¨

---

## ğŸ“ å­¦ä¹ èµ„æº

- **Spring Boot æ–‡æ¡£**ï¼šhttps://spring.io/projects/spring-boot
- **Vue.js æ–‡æ¡£**ï¼šhttps://vuejs.org/
- **Nginx æ–‡æ¡£**ï¼šhttps://nginx.org/en/docs/
- **MySQL æ–‡æ¡£**ï¼šhttps://dev.mysql.com/doc/
- **Linux å‘½ä»¤é€ŸæŸ¥**ï¼šhttps://linux.die.net/

---

**è®°ä½ï¼šéƒ¨ç½²åèƒ½ä¿®æ”¹é¡¹ç›®ï¼é€šè¿‡ Git ç®¡ç†ä»£ç ï¼Œéšæ—¶æ›´æ–°ï¼** ğŸš€

