# 短信服务配置说明

## 功能说明
养生计划的短信提醒功能已集成，可以在指定时间向用户发送养生任务提醒短信。

## 配置步骤

### 1. 注册阿里云账号并开通短信服务

1. 访问 [阿里云官网](https://www.aliyun.com/)
2. 注册并登录账号
3. 搜索"短信服务"并开通
4. 进入短信服务控制台

### 2. 获取AccessKey

1. 点击右上角头像 → AccessKey管理
2. 创建AccessKey（会得到AccessKeyId和AccessKeySecret）
3. **重要：妥善保管，不要泄露！**

### 3. 申请短信签名

1. 在短信服务控制台 → 国内消息 → 签名管理
2. 添加签名（例如：灵素养生）
3. 选择签名用途：验证码/通知
4. 等待审核通过（通常1-2小时）

### 4. 申请短信模板

1. 在短信服务控制台 → 国内消息 → 模板管理
2. 添加模板，示例：

```
【灵素养生】您好，${task}提醒时间到了（${time}），请及时完成养生任务。
```

3. 模板变量：
   - `${task}`: 任务名称
   - `${time}`: 提醒时间
4. 等待审核通过

### 5. 配置环境变量

在服务器或本地环境中设置以下环境变量：

**Linux/Mac:**
```bash
export ALIYUN_SMS_ACCESS_KEY_ID=你的AccessKeyId
export ALIYUN_SMS_ACCESS_KEY_SECRET=你的AccessKeySecret
export ALIYUN_SMS_SIGN_NAME=灵素养生
export ALIYUN_SMS_TEMPLATE_CODE=SMS_xxxxxxxx
```

**Windows:**
```cmd
set ALIYUN_SMS_ACCESS_KEY_ID=你的AccessKeyId
set ALIYUN_SMS_ACCESS_KEY_SECRET=你的AccessKeySecret
set ALIYUN_SMS_SIGN_NAME=灵素养生
set ALIYUN_SMS_TEMPLATE_CODE=SMS_xxxxxxxx
```

**或者直接在 application.yml 中配置（不推荐，安全性低）:**
```yaml
aliyun:
  sms:
    access-key-id: 你的AccessKeyId
    access-key-secret: 你的AccessKeySecret
    sign-name: 灵素养生
    template-code: SMS_xxxxxxxx
```

### 6. 重启应用

配置完成后，重启Spring Boot应用：
```bash
mvn spring-boot:run
```

## 使用方法

1. 在养生计划页面，开启"短信提醒"开关
2. 输入手机号（11位中国大陆手机号）
3. 选择提醒时间（例如：20:00）
4. 点击"保存提醒"
5. 系统会在每天指定时间发送短信提醒

## 费用说明

- 阿里云短信服务按量计费
- 国内短信：约 0.045元/条
- 新用户通常有免费额度（100-500条）
- 建议充值少量金额测试

## 测试接口

测试短信服务是否配置成功：
```bash
curl http://localhost:8080/api/sms/test
```

手动发送测试短信：
```bash
curl -X POST http://localhost:8080/api/sms/send-reminder \
  -H "Content-Type: application/json" \
  -d '{
    "phoneNumber": "13800138000",
    "taskName": "测试任务",
    "taskTime": "20:00"
  }'
```

## 注意事项

1. **安全性**：不要将AccessKey提交到Git仓库
2. **频率限制**：阿里云有发送频率限制（默认1条/分钟/手机号）
3. **内容审核**：短信内容需符合规范，不能包含违规内容
4. **实名认证**：需要完成阿里云实名认证才能使用
5. **余额监控**：定期检查账户余额，避免欠费停服

## 常见问题

### Q: 短信发送失败？
A: 检查以下几点：
- AccessKey是否正确
- 签名和模板是否审核通过
- 手机号格式是否正确
- 账户余额是否充足

### Q: 收不到短信？
A: 可能原因：
- 手机号被运营商拦截
- 短信内容触发敏感词
- 发送频率过高被限制
- 检查阿里云控制台的发送记录

### Q: 如何查看发送记录？
A: 登录阿里云控制台 → 短信服务 → 发送记录查询

## 替代方案

如果不想使用阿里云，也可以选择：
- 腾讯云短信服务
- 华为云短信服务
- 网易云信
- 容联云通讯

配置方法类似，只需修改对应的SDK和配置即可。
