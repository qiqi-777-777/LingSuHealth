# LingSu Health é¡¹ç›®éƒ¨ç½²æŒ‡å—

## ğŸ“¦ éƒ¨ç½²æ¶æ„

### æœåŠ¡å™¨ç¯å¢ƒè¦æ±‚
- **æ“ä½œç³»ç»Ÿ**ï¼šUbuntu 20.04+ / CentOS 7+ (æ¨è Ubuntu 22.04)
- **CPU**ï¼š2æ ¸ä»¥ä¸Š
- **å†…å­˜**ï¼š4GBä»¥ä¸Š
- **ç¡¬ç›˜**ï¼š20GBä»¥ä¸Š
- **å…¬ç½‘IP**ï¼š1ä¸ª
- **åŸŸå**ï¼šå¯é€‰ï¼ˆæ¨èè´­ä¹°ï¼Œå¦‚ lingshuhealth.comï¼‰

### è½¯ä»¶ç¯å¢ƒ
- Java 17+
- Node.js 20+
- MySQL 8.0+
- Nginx 1.20+
- Git

---

## ğŸš€ ä¸€ã€æœåŠ¡å™¨å‡†å¤‡

### 1.1 è¿æ¥æœåŠ¡å™¨
```bash
ssh root@ä½ çš„æœåŠ¡å™¨IP
```

### 1.2 å®‰è£…åŸºç¡€è½¯ä»¶
```bash
# æ›´æ–°ç³»ç»Ÿ
sudo apt update && sudo apt upgrade -y

# å®‰è£… Java 17
sudo apt install openjdk-17-jdk -y
java -version

# å®‰è£… MySQL
sudo apt install mysql-server -y
sudo systemctl start mysql
sudo systemctl enable mysql

# å®‰è£… Nginx
sudo apt install nginx -y
sudo systemctl start nginx
sudo systemctl enable nginx

# å®‰è£… Node.js 20
curl -fsSL https://deb.nodesource.com/setup_20.x | sudo -E bash -
sudo apt install nodejs -y
node -v
npm -v

# å®‰è£… Git
sudo apt install git -y

# å®‰è£… Maven (æ„å»ºåç«¯)
sudo apt install maven -y
```

---

## ğŸ“‚ äºŒã€ä»£ç ç®¡ç†ï¼ˆGitHubï¼‰

### 2.1 åˆ›å»º GitHub ä»“åº“

**å¼ºçƒˆå»ºè®®ä½¿ç”¨ GitHubï¼** åŸå› ï¼š
- âœ… ç‰ˆæœ¬æ§åˆ¶ï¼Œéšæ—¶å›é€€
- âœ… å¤šè®¾å¤‡å¼€å‘ï¼ˆæœ¬åœ° + æœåŠ¡å™¨ï¼‰
- âœ… ä»£ç å¤‡ä»½ï¼Œé˜²æ­¢ä¸¢å¤±
- âœ… æŒç»­é›†æˆ/éƒ¨ç½²ï¼ˆCI/CDï¼‰

**æ“ä½œæ­¥éª¤ï¼š**

1. åœ¨ GitHub ä¸Šåˆ›å»ºæ–°ä»“åº“ï¼š`LingSuHealth`
2. åœ¨æœ¬åœ°é¡¹ç›®æ ¹ç›®å½•ï¼š

```bash
# åˆå§‹åŒ– Git
git init

# æ·»åŠ è¿œç¨‹ä»“åº“
git remote add origin https://github.com/ä½ çš„ç”¨æˆ·å/LingSuHealth.git

# æ·»åŠ  .gitignoreï¼ˆé‡è¦ï¼é¿å…ä¸Šä¼ æ•æ„Ÿä¿¡æ¯ï¼‰
# ç¡®ä¿ä»¥ä¸‹æ–‡ä»¶/ç›®å½•è¢«å¿½ç•¥ï¼š
# - node_modules/
# - target/
# - .env
# - application.yml (æˆ–ä½¿ç”¨æ¨¡æ¿)
# - *.log

# æäº¤ä»£ç 
git add .
git commit -m "Initial commit"
git push -u origin main
```

### 2.2 ä¿æŠ¤æ•æ„Ÿä¿¡æ¯

**åˆ›å»ºé…ç½®æ–‡ä»¶æ¨¡æ¿ï¼š**

åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»º `application.yml.template`ï¼š

```yaml
server:
  port: 8080

spring:
  application:
    name: LingSuHealth
  datasource:
    url: jdbc:mysql://localhost:3306/lingsu_health?useSSL=false&serverTimezone=Asia/Shanghai
    username: YOUR_MYSQL_USERNAME
    password: YOUR_MYSQL_PASSWORD
    driver-class-name: com.mysql.cj.jdbc.Driver

mybatis-plus:
  configuration:
    map-underscore-to-camel-case: true
    log-impl: org.apache.ibatis.logging.stdout.StdOutImpl
  mapper-locations: classpath*:/mapper/HealthCheckinMapper.xml
  type-aliases-package: com.lingsu.health.entity

deepseek:
  api:
    key: YOUR_DEEPSEEK_API_KEY
    url: https://api.deepseek.com/v1/chat/completions
```

**æ³¨æ„ï¼š** çœŸå®çš„ `application.yml` ä¸è¦æäº¤åˆ° GitHubï¼

---

## ğŸ—„ï¸ ä¸‰ã€æ•°æ®åº“éƒ¨ç½²

### 3.1 é…ç½® MySQL

```bash
# ç™»å½• MySQL
sudo mysql -u root -p

# åˆ›å»ºæ•°æ®åº“å’Œç”¨æˆ·
CREATE DATABASE lingsu_health CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
CREATE USER 'lingshu_user'@'localhost' IDENTIFIED BY 'ä½ çš„å¼ºå¯†ç ';
GRANT ALL PRIVILEGES ON lingsu_health.* TO 'lingshu_user'@'localhost';
FLUSH PRIVILEGES;
EXIT;
```

### 3.2 å¯¼å…¥æ•°æ®åº“

å°† `lingsu_health.sql` ä¸Šä¼ åˆ°æœåŠ¡å™¨å¹¶å¯¼å…¥ï¼š

```bash
# ä¸Šä¼ æ–‡ä»¶ï¼ˆåœ¨æœ¬åœ°ç”µè„‘æ‰§è¡Œï¼‰
scp lingsu_health.sql root@æœåŠ¡å™¨IP:/tmp/

# åœ¨æœåŠ¡å™¨ä¸Šå¯¼å…¥
mysql -u lingshu_user -p lingsu_health < /tmp/lingsu_health.sql
```

---

## â˜• å››ã€åç«¯éƒ¨ç½²

### 4.1 æ‹‰å–ä»£ç åˆ°æœåŠ¡å™¨

```bash
# åœ¨æœåŠ¡å™¨ä¸Šåˆ›å»ºé¡¹ç›®ç›®å½•
mkdir -p /opt/lingsu-health
cd /opt/lingsu-health

# å…‹éš†ä»£ç 
git clone https://github.com/ä½ çš„ç”¨æˆ·å/LingSuHealth.git .

# æˆ–è€…ä½¿ç”¨ scp ä¸Šä¼ æ•´ä¸ªé¡¹ç›®
# scp -r D:\ideaProject\LingSuHealth root@æœåŠ¡å™¨IP:/opt/lingsu-health/
```

### 4.2 é…ç½®åç«¯

```bash
# å¤åˆ¶é…ç½®æ–‡ä»¶å¹¶ä¿®æ”¹
cp src/main/resources/application.yml.template src/main/resources/application.yml
vim src/main/resources/application.yml

# ä¿®æ”¹æ•°æ®åº“å¯†ç ã€DeepSeek API Key ç­‰
```

### 4.3 æ„å»ºåç«¯

```bash
# ä½¿ç”¨ Maven æ„å»º
mvn clean package -DskipTests

# JAR æ–‡ä»¶ä¼šç”Ÿæˆåœ¨ target/LingSuHealth-0.0.1-SNAPSHOT.jar
```

### 4.4 è¿è¡Œåç«¯ï¼ˆæ–¹å¼ä¸€ï¼šç›´æ¥è¿è¡Œï¼‰

```bash
# å‰å°è¿è¡Œï¼ˆæµ‹è¯•ç”¨ï¼‰
java -jar target/LingSuHealth-0.0.1-SNAPSHOT.jar

# åå°è¿è¡Œ
nohup java -jar target/LingSuHealth-0.0.1-SNAPSHOT.jar > /opt/lingsu-health/backend.log 2>&1 &
```

### 4.5 è¿è¡Œåç«¯ï¼ˆæ–¹å¼äºŒï¼šSystemd æœåŠ¡ï¼Œæ¨èï¼‰

åˆ›å»ºæœåŠ¡æ–‡ä»¶ï¼š

```bash
sudo vim /etc/systemd/system/lingsu-health.service
```

å†…å®¹ï¼š

```ini
[Unit]
Description=LingSu Health Backend Service
After=network.target mysql.service

[Service]
Type=simple
User=root
WorkingDirectory=/opt/lingsu-health
ExecStart=/usr/bin/java -jar /opt/lingsu-health/target/LingSuHealth-0.0.1-SNAPSHOT.jar
Restart=on-failure
RestartSec=10
StandardOutput=journal
StandardError=journal

[Install]
WantedBy=multi-user.target
```

å¯åŠ¨æœåŠ¡ï¼š

```bash
sudo systemctl daemon-reload
sudo systemctl start lingsu-health
sudo systemctl enable lingsu-health
sudo systemctl status lingsu-health

# æŸ¥çœ‹æ—¥å¿—
sudo journalctl -u lingsu-health -f
```

---

## ğŸ¨ äº”ã€å‰ç«¯éƒ¨ç½²

### 5.1 æœ¬åœ°æ„å»ºå‰ç«¯

**é‡è¦ï¼š** å‰ç«¯éœ€è¦åœ¨æœ¬åœ°æ„å»ºï¼Œç„¶åä¸Šä¼ åˆ°æœåŠ¡å™¨ï¼

```bash
# åœ¨æœ¬åœ°é¡¹ç›®çš„ ui ç›®å½•
cd ui

# ä¿®æ”¹ API åœ°å€ï¼ˆå¦‚æœéœ€è¦ï¼‰
# ç¼–è¾‘ src/services/api.tsï¼Œå°† baseURL æ”¹ä¸ºç”Ÿäº§ç¯å¢ƒåœ°å€
# å¦‚: const API_BASE_URL = 'https://ä½ çš„åŸŸå/api' æˆ– 'http://æœåŠ¡å™¨IP:8080'

# å®‰è£…ä¾èµ–
npm install

# æ„å»ºç”Ÿäº§ç‰ˆæœ¬
npm run build

# æ„å»ºå®Œæˆåï¼Œdist ç›®å½•åŒ…å«æ‰€æœ‰é™æ€æ–‡ä»¶
```

### 5.2 ä¸Šä¼ åˆ°æœåŠ¡å™¨

```bash
# åœ¨æœ¬åœ°æ‰§è¡Œï¼ˆå‡è®¾åœ¨ ui ç›®å½•ä¸‹ï¼‰
scp -r dist/* root@æœåŠ¡å™¨IP:/var/www/lingsu-health/

# æˆ–è€…åœ¨æœåŠ¡å™¨ä¸Šæ„å»ºï¼ˆå¦‚æœæœåŠ¡å™¨æ€§èƒ½è¶³å¤Ÿï¼‰
cd /opt/lingsu-health/ui
npm install
npm run build
sudo mkdir -p /var/www/lingsu-health
sudo cp -r dist/* /var/www/lingsu-health/
```

### 5.3 é…ç½® Nginx

```bash
# ç¼–è¾‘ Nginx é…ç½®
sudo vim /etc/nginx/sites-available/lingsu-health
```

é…ç½®å†…å®¹ï¼š

```nginx
server {
    listen 80;
    server_name ä½ çš„åŸŸåæˆ–æœåŠ¡å™¨IP;  # å¦‚ lingshuhealth.com æˆ– 123.45.67.89

    # å‰ç«¯é™æ€æ–‡ä»¶
    root /var/www/lingsu-health;
    index index.html;

    # å‰ç«¯è·¯ç”±ï¼ˆVue Router history æ¨¡å¼ï¼‰
    location / {
        try_files $uri $uri/ /index.html;
    }

    # åç«¯ API åå‘ä»£ç†
    location /api/ {
        proxy_pass http://localhost:8080/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        
        # WebSocket æ”¯æŒï¼ˆå¦‚æœéœ€è¦ï¼‰
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
    }

    # é™æ€èµ„æºç¼“å­˜
    location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf)$ {
        expires 1y;
        add_header Cache-Control "public, immutable";
    }
}
```

å¯ç”¨é…ç½®ï¼š

```bash
# åˆ›å»ºè½¯é“¾æ¥
sudo ln -s /etc/nginx/sites-available/lingsu-health /etc/nginx/sites-enabled/

# æµ‹è¯•é…ç½®
sudo nginx -t

# é‡å¯ Nginx
sudo systemctl restart nginx
```

### 5.4 é…ç½®å‰ç«¯ API åœ°å€

ç¼–è¾‘ `ui/src/services/api.ts`ï¼Œç¡®ä¿ API åœ°å€æ­£ç¡®ï¼š

```typescript
// ç”Ÿäº§ç¯å¢ƒ
const API_BASE_URL = '/api';  // é€šè¿‡ Nginx åå‘ä»£ç†

// æˆ–è€…ç›´æ¥æŒ‡å‘åç«¯
// const API_BASE_URL = 'http://æœåŠ¡å™¨IP:8080';
```

---

## ğŸ”’ å…­ã€HTTPS é…ç½®ï¼ˆæ¨èï¼‰

ä½¿ç”¨ Let's Encrypt å…è´¹è¯ä¹¦ï¼š

```bash
# å®‰è£… Certbot
sudo apt install certbot python3-certbot-nginx -y

# è‡ªåŠ¨é…ç½® HTTPS
sudo certbot --nginx -d ä½ çš„åŸŸå

# è‡ªåŠ¨ç»­æœŸ
sudo certbot renew --dry-run
```

---

## ğŸ”„ ä¸ƒã€éƒ¨ç½²åä¿®æ”¹é¡¹ç›®çš„æµç¨‹

### æ–¹å¼ä¸€ï¼šæœ¬åœ°ä¿®æ”¹ â†’ æ¨é€ â†’ æœåŠ¡å™¨æ‹‰å–ï¼ˆæ¨èï¼‰

```bash
# 1. åœ¨æœ¬åœ°ä¿®æ”¹ä»£ç 
# 2. æäº¤åˆ° GitHub
git add .
git commit -m "ä¿®å¤äº†æŸä¸ªé—®é¢˜"
git push origin main

# 3. åœ¨æœåŠ¡å™¨ä¸Šæ‹‰å–æ›´æ–°
ssh root@æœåŠ¡å™¨IP
cd /opt/lingsu-health
git pull origin main

# 4. åç«¯é‡æ–°æ„å»º
mvn clean package -DskipTests
sudo systemctl restart lingsu-health

# 5. å‰ç«¯é‡æ–°æ„å»ºï¼ˆå¦‚æœå‰ç«¯æœ‰ä¿®æ”¹ï¼‰
cd ui
npm run build
sudo cp -r dist/* /var/www/lingsu-health/
```

### æ–¹å¼äºŒï¼šç›´æ¥åœ¨æœåŠ¡å™¨ä¸Šä¿®æ”¹ï¼ˆä¸æ¨èï¼‰

```bash
# åœ¨æœåŠ¡å™¨ä¸Šä¿®æ”¹ä»£ç 
vim src/main/java/com/lingsu/health/controller/XXXController.java

# é‡æ–°æ„å»ºå’Œé‡å¯
mvn clean package -DskipTests
sudo systemctl restart lingsu-health

# ä½†è¿™æ ·ä¼šä¸¢å¤±ç‰ˆæœ¬æ§åˆ¶ï¼å»ºè®®ä¿®æ”¹åæ¨é€åˆ° GitHub
git add .
git commit -m "æœåŠ¡å™¨ä¸Šçš„ä¿®æ”¹"
git push origin main
```

---

## ğŸ“ å…«ã€ç›®å½•ç»“æ„æ€»ç»“

```
æœåŠ¡å™¨ç›®å½•ç»“æ„ï¼š
/opt/lingsu-health/              # åç«¯ä»£ç ç›®å½•
â”œâ”€â”€ src/                         # Java æºä»£ç 
â”œâ”€â”€ target/                      # ç¼–è¯‘åçš„ JAR
â”œâ”€â”€ ui/                          # å‰ç«¯æºä»£ç 
â”‚   â””â”€â”€ dist/                    # æ„å»ºåçš„å‰ç«¯é™æ€æ–‡ä»¶
â”œâ”€â”€ lingsu_health.sql            # æ•°æ®åº“è„šæœ¬
â””â”€â”€ pom.xml                      # Maven é…ç½®

/var/www/lingsu-health/          # å‰ç«¯éƒ¨ç½²ç›®å½•ï¼ˆNginx æä¾›ï¼‰
â”œâ”€â”€ index.html
â”œâ”€â”€ assets/
â””â”€â”€ ...

/etc/nginx/sites-available/      # Nginx é…ç½®
â””â”€â”€ lingsu-health

/etc/systemd/system/             # ç³»ç»ŸæœåŠ¡
â””â”€â”€ lingsu-health.service
```

---

## ğŸ› ï¸ ä¹ã€å¸¸ç”¨è¿ç»´å‘½ä»¤

### åç«¯ç®¡ç†
```bash
# æŸ¥çœ‹åç«¯çŠ¶æ€
sudo systemctl status lingsu-health

# é‡å¯åç«¯
sudo systemctl restart lingsu-health

# æŸ¥çœ‹åç«¯æ—¥å¿—
sudo journalctl -u lingsu-health -f

# æ‰‹åŠ¨è¿è¡Œï¼ˆæµ‹è¯•ç”¨ï¼‰
java -jar target/LingSuHealth-0.0.1-SNAPSHOT.jar
```

### å‰ç«¯ç®¡ç†
```bash
# é‡æ–°éƒ¨ç½²å‰ç«¯
cd /opt/lingsu-health/ui
npm run build
sudo cp -r dist/* /var/www/lingsu-health/

# æµ‹è¯• Nginx é…ç½®
sudo nginx -t

# é‡å¯ Nginx
sudo systemctl restart nginx
```

### æ•°æ®åº“ç®¡ç†
```bash
# å¤‡ä»½æ•°æ®åº“
mysqldump -u lingshu_user -p lingsu_health > backup_$(date +%Y%m%d).sql

# æ¢å¤æ•°æ®åº“
mysql -u lingshu_user -p lingsu_health < backup_20251105.sql
```

### Git ç®¡ç†
```bash
# æ‹‰å–æœ€æ–°ä»£ç 
git pull origin main

# æŸ¥çœ‹å½“å‰çŠ¶æ€
git status

# æŸ¥çœ‹æäº¤å†å²
git log --oneline

# å›é€€åˆ°æŸä¸ªç‰ˆæœ¬
git reset --hard commit_id
```

---

## ğŸ” åã€æ•…éšœæ’æŸ¥

### 1. åç«¯å¯åŠ¨å¤±è´¥
```bash
# æŸ¥çœ‹æ—¥å¿—
sudo journalctl -u lingsu-health -f

# å¸¸è§é—®é¢˜ï¼š
# - ç«¯å£è¢«å ç”¨ï¼šlsof -i :8080
# - æ•°æ®åº“è¿æ¥å¤±è´¥ï¼šæ£€æŸ¥ application.yml é…ç½®
# - Java ç‰ˆæœ¬ä¸å¯¹ï¼šjava -version
```

### 2. å‰ç«¯æ— æ³•è®¿é—®
```bash
# æ£€æŸ¥ Nginx çŠ¶æ€
sudo systemctl status nginx

# æ£€æŸ¥æ–‡ä»¶æƒé™
ls -la /var/www/lingsu-health/

# æŸ¥çœ‹ Nginx é”™è¯¯æ—¥å¿—
sudo tail -f /var/log/nginx/error.log
```

### 3. API è¯·æ±‚å¤±è´¥
```bash
# æ£€æŸ¥åç«¯æ˜¯å¦è¿è¡Œ
curl http://localhost:8080/api/health

# æ£€æŸ¥é˜²ç«å¢™
sudo ufw status
sudo ufw allow 80
sudo ufw allow 443
```

---

## ğŸ“Š åä¸€ã€æ€§èƒ½ä¼˜åŒ–å»ºè®®

### 1. æ•°æ®åº“ä¼˜åŒ–
```sql
-- æ·»åŠ ç´¢å¼•
CREATE INDEX idx_user_date ON health_checkins(user_id, checkin_date);

-- å®šæœŸæ¸…ç†æ—¥å¿—
SET GLOBAL slow_query_log = 'ON';
```

### 2. åç«¯ä¼˜åŒ–
```yaml
# application.yml
spring:
  datasource:
    hikari:
      maximum-pool-size: 10
      minimum-idle: 5
```

### 3. å‰ç«¯ä¼˜åŒ–
- å¯ç”¨ Gzip å‹ç¼©
- é…ç½® CDN åŠ é€Ÿ
- å›¾ç‰‡æ‡’åŠ è½½

---

## âœ… éƒ¨ç½²æ£€æŸ¥æ¸…å•

éƒ¨ç½²å®Œæˆåï¼Œæ£€æŸ¥ä»¥ä¸‹é¡¹ç›®ï¼š

- [ ] æ•°æ®åº“æˆåŠŸåˆ›å»ºå¹¶å¯¼å…¥
- [ ] åç«¯æœåŠ¡æ­£å¸¸è¿è¡Œï¼ˆ`systemctl status lingsu-health`ï¼‰
- [ ] å‰ç«¯é¡µé¢å¯ä»¥è®¿é—®ï¼ˆæµè§ˆå™¨æ‰“å¼€ `http://æœåŠ¡å™¨IP`ï¼‰
- [ ] API è¯·æ±‚æ­£å¸¸ï¼ˆç™»å½•ã€æ³¨å†ŒåŠŸèƒ½æµ‹è¯•ï¼‰
- [ ] Nginx åå‘ä»£ç†å·¥ä½œæ­£å¸¸
- [ ] HTTPS è¯ä¹¦é…ç½®ï¼ˆå¦‚æœéœ€è¦ï¼‰
- [ ] é˜²ç«å¢™è§„åˆ™é…ç½®æ­£ç¡®
- [ ] ä»£ç å·²æ¨é€åˆ° GitHub
- [ ] æ•°æ®åº“å®šæœŸå¤‡ä»½è®¡åˆ’

---

## ğŸ“ æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·å‚è€ƒï¼š
- Spring Boot å®˜æ–¹æ–‡æ¡£ï¼šhttps://spring.io/projects/spring-boot
- Vue.js å®˜æ–¹æ–‡æ¡£ï¼šhttps://vuejs.org/
- Nginx å®˜æ–¹æ–‡æ¡£ï¼šhttps://nginx.org/en/docs/

---

**ç¥éƒ¨ç½²é¡ºåˆ©ï¼ğŸ‰**

